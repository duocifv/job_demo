(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2658:(e,t,l)=>{Promise.resolve().then(l.bind(l,706)),Promise.resolve().then(l.bind(l,379)),Promise.resolve().then(l.t.bind(l,6944,23)),Promise.resolve().then(l.t.bind(l,3601,23))},706:(e,t,l)=>{"use strict";l.d(t,{default:()=>o});var a=l(5155),s=l(383),r=l(5906),n=l(8767);let i=new s.E,o=e=>{let{children:t}=e;return(0,a.jsxs)(r.Ht,{client:i,children:[t,(0,a.jsx)(n.E,{initialIsOpen:!1})]})}},379:(e,t,l)=>{"use strict";l.d(t,{default:()=>i});var a=l(5155),s=l(6046),r=l(2115);let n="https://cms.duocnv.top/wp-json/custom-data-json/v1",i=()=>{let[e,t]=(0,r.useState)([]),[l,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),v=(0,s.usePathname)(),p="/"===v?"home":v.replace(/^\/|\/$/g,"").replaceAll("/","_");return(0,r.useEffect)(()=>{fetch("".concat(n,"/list/").concat(p),{method:"GET",headers:{"Content-Type":"application/json"}}).then(async e=>{if(e.ok){let{data:l}=await (null==e?void 0:e.json());if(!l)return t([]);let a=JSON.parse(l);t(Object.keys(null==a?void 0:a.data).map(e=>({[e]:null==a?void 0:a.data[e]})))}else{console.log("Error: ".concat(e.status," - ").concat(await e.text()));return}}).catch(e=>console.error("Error fetching data:",e))},[p,l]),(0,a.jsxs)("div",{className:"fixed z-50 top-0 left-0 w-80 min-h-full bg-gray-200 p-0  ".concat(o&&"!w-0"),children:[(0,a.jsx)("button",{onClick:()=>d(!o),className:"absolute top-0 w-14 h-14 bg-red-400 right-[-56px]",children:"Edit"}),(0,a.jsxs)("div",{className:"p-4 min-h-full ".concat(o?"hidden":""," max-h-full overflow-y-scroll"),children:[(0,a.jsx)(m,{segments:p,items:e,setItems:t,view:h,setView:x}),(0,a.jsx)(c,{items:e,setItems:t,segments:p,setRefresh:i}),(0,a.jsx)(u,{items:e,setView:x})]})]})},o=e=>{let[t,l]=(0,r.useState)("text"),[s,n]=(0,r.useState)(),[i,o]=(0,r.useState)();(0,r.useEffect)(()=>{e.loading&&(o(""),n(""))},[e.loading]);let d=e.items.find(t=>t[e.keys])||{};return(0,a.jsxs)("div",{className:"mb-4 flex overflow-hidden",children:[(0,a.jsx)("div",{className:"flex justify-between mb-2",children:(0,a.jsxs)("select",{onChange:t=>{"text"===t.target.value&&e.setImage(null),l(t.target.value)},value:t,children:[(0,a.jsx)("option",{value:"text",children:"Text"}),(0,a.jsx)("option",{value:"image",children:"Image"})]})}),(0,a.jsxs)("div",{className:"row",children:["text"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"text",className:"border border-gray-600 rounded-md h-8 mb-4 w-full px-3",value:s,onChange:e=>n(e.target.value)}),(0,a.jsx)("input",{type:"text",className:"border border-gray-600 rounded-md h-8 mb-4 w-full px-3",value:i,onChange:t=>{let{value:l}=t.target;o(l),e.setValues(t=>({...d[e.keys],...t,[s]:l}))}})]}),"image"===t&&(0,a.jsx)("input",{type:"file",accept:"image/*",className:"text-sm",onChange:t=>{let l=t.target.files[0];l?e.setImage(l):console.error("No file selected!")}})]})]})},d=e=>{var t;let l={};return null===(t=e.updateList)||void 0===t?void 0:t.map((t,s)=>{let[n,i]=(0,r.useState)();return l[t[0]]=n||t[1],(0,r.useEffect)(()=>{e.setEditValue(l),console.log("item",l)},[n]),(0,a.jsxs)("div",{children:[t[0],(0,a.jsx)("textarea",{rows:5,className:"border border-gray-600 rounded-md block w-full px-3 mb-4",value:n||t[1],defaultValue:t[1],onChange:e=>i(e.target.value)})]},s)})},u=e=>{var t;return(0,a.jsx)("div",{className:"max-h-[74vh] overflow-y-scroll overflow-hidden scrollbar",children:null==e?void 0:null===(t=e.items)||void 0===t?void 0:t.map((t,l)=>{let s;let r=Object.keys(t)[0],n=t[r];return"object"==typeof n&&null!==n&&(s=Object.entries(JSON.parse(JSON.stringify(n,null,2)))),(0,a.jsx)("div",{className:"border-b border-gray-700 mt-2 flex justify-between",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-bold",children:r}),(0,a.jsx)("button",{className:"text-blue-500 underline",onClick:()=>e.setView({key:r,value:n}),children:"Edit"})]}),s?null==s?void 0:s.map((e,t)=>e[0]&&(0,a.jsx)("div",{className:"flex leading-5 p-1 text-sm",children:(0,a.jsxs)("div",{children:[e[1],(0,a.jsx)("span",{className:"text-sm bg-white ml-2 px-1 rounded-lg text-[13px]",children:e[0]})]})},t)):(0,a.jsx)("div",{className:"text-sm",children:n})]})},l)})})},c=e=>{let[t,l]=(0,r.useState)(""),[s,i]=(0,r.useState)(""),[d,u]=(0,r.useState)(1),[c,m]=(0,r.useState)(null),[x,v]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1),[b,j]=(0,r.useState)({}),f=async()=>{let e=new FormData;e.append("image",c);try{let t=await fetch("http://localhost:3002/upload",{method:"POST",body:e}),l=await t.json();if(null==l?void 0:l.file)return l.file;alert("Upload failed!")}catch(e){console.error("Error uploading image:",e),alert("An error occurred while uploading the image.")}},w=async()=>{let a;if(g(!0),t&&c&&(a=await f()),(t&&s||t&&b)&&(a=1===d?s:b),!a)return alert("Vui l\xf2ng nhập key v\xe0 value");let r={[t]:a},o=[...e.items,r];console.log("newItems",o);let u=o.reduce((e,t)=>{let[l,a]=Object.entries(t)[0];return e[l]=a,e},{}),m="update/".concat(e.segments),h="PUT";0===e.items.length&&(m="add",h="POST"),fetch("".concat(n,"/").concat(m),{method:h,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.segments,data:u})}).then(async e=>(g(!1),alert("Đ\xe3 tạo xong"),await e.json())).then(()=>{e.setRefresh(e=>!e),l(""),i("")}).catch(e=>console.error("Error saving data:",e))};return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"key",children:"Key"}),(0,a.jsx)("input",{type:"text",className:"border border-gray-600 rounded-md h-8 mb-2 block w-full px-3",value:t,onChange:e=>l(h(e))}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("label",{htmlFor:"value",children:"Value"}),(0,a.jsxs)("div",{children:["Number rows:",(0,a.jsx)("input",{type:"text",className:"border w-12 border-gray-600 rounded-md h-8 mb-4 px-3",value:d,onChange:e=>u(Number(e.target.value))})]})]}),1===d&&(0,a.jsx)("input",{type:"text",className:"border border-gray-600 rounded-md h-8 mb-4 w-full px-3",value:s,onChange:e=>i(e.target.value)}),d>1&&[...Array(d)].map((l,s)=>(0,a.jsx)(o,{setValues:j,image:c,items:e.items,keys:t,setImage:m,loading:p},s)),x&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"Preview:"}),(0,a.jsx)("img",{src:x,alt:"Image Preview",style:{width:"200px",height:"auto"}})]}),(0,a.jsx)("div",{className:"flex justify-between",children:(0,a.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2 w-full ".concat(p&&"bg-gray-500"),onClick:w,children:p?"Loading":"Done"})})]})},m=e=>{var t,l,s;let i;let[o,u]=(0,r.useState)(""),[c,m]=(0,r.useState)("");return"object"==typeof(null===(t=e.view)||void 0===t?void 0:t.value)&&(null===(l=e.view)||void 0===l?void 0:l.value)!==null&&(i=Object.entries(null===(s=e.view)||void 0===s?void 0:s.value)),e.view&&(0,a.jsxs)("div",{className:"absolute inset-0 bg-gray-200 z-50 p-4",children:[(0,a.jsx)("button",{className:"ml-auto block px-4 py-1 text-blue-500",onClick:()=>e.setView(null),children:"Close"}),(0,a.jsx)("label",{htmlFor:"editKey",children:"Key"}),(0,a.jsx)("input",{type:"text",className:"border border-gray-600 rounded-md block w-full px-3 mb-2",defaultValue:e.view.key,onChange:e=>u(h(e))}),i?(0,a.jsx)(d,{updateList:i,setEditValue:m}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{htmlFor:"editValue",children:"Value"}),(0,a.jsx)("textarea",{rows:5,className:"border border-gray-600 rounded-md block w-full px-3 mb-4",defaultValue:e.view.value,onChange:e=>m(e.target.value)})]}),(0,a.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2",onClick:()=>{if(!e.view)return null;let t=e.items.map(t=>t[e.view.key]?{[o||e.view.key]:c}:t),l=t.reduce((e,t)=>{let[l,a]=Object.entries(t)[0];return e[l]=a,e},{});fetch("".concat(n,"/update/").concat(e.segments),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{...l}})}).then(async e=>await e.json()).then(()=>{e.setItems(t),e.setView(null),alert("Đ\xe3 cập nhật")}).catch(e=>console.error("Error updating data:",e))},children:"Update"})]})},h=e=>{let t=e.target.value;return(t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/[^a-zA-Z0-9]/g,"")}},6944:()=>{},3601:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[536,33,441,517,358],()=>t(2658)),_N_E=e.O()}]);